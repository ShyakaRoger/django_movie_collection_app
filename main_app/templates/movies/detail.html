{% extends "base.html" %}
{% block content %}
<h1>{{ movie.title }}</h1>
<p>Genre: {{ movie.get_genre_display|default:movie.genre }}</p>
<p>Release year: {{ movie.release_year }}</p>
<p>Duration: {{ movie.duration }} mins</p>

{% if user.is_authenticated %}
<div class="movie-actions">
  <a href="{% url 'movie-update' movie.id %}" class="btn warn">Edit</a>
  <a href="{% url 'movie-delete' movie.id %}" class="btn danger">Delete</a>
</div>
{% endif %}

{% if movie.description %}
  <hr>
  <h3>Description</h3>
  <p>{{ movie.description|linebreaksbr }}</p>
{% endif %}

<h3>Reviews</h3>
<ul class="reviews">
  {% for review in movie.reviews.all %}
    <li>
      <strong>{{ review.author.username }}</strong> â€” {{ review.rating }}/5
      {% if review.comment %}
        <div>{{ review.comment|linebreaksbr }}</div>
      {% endif %}
      <small>{{ review.created_at }}</small>

      {% if user.is_authenticated %}
      <div>
        <form action="{% url 'review-delete' review.id %}" method="POST">
          {% csrf_token %}
          <button type="submit">Delete Review</button>
        </form>
      </div>
      {% endif %}
    </li>
  {% empty %}
    <li>No reviews yet.</li>
  {% endfor %}
</ul>

<h3>Add a review</h3>
{% if user.is_authenticated %}
  <form action="{% url 'review-add' movie.id %}" method="POST">
    {% csrf_token %}
    {{ form.non_field_errors }}

    <div>
      <label for="{{ form.rating.id_for_label }}">Rating</label>
      {{ form.rating.errors }}{{ form.rating }}
    </div>

    <div>
      <label for="{{ form.comment.id_for_label }}">Comment</label>
      {{ form.comment.errors }}{{ form.comment }}
    </div>

    <button type="submit">Submit</button>
  </form>
{% else %}
  <p><a href="{% url 'login' %}">Log in</a> to add a review.</p>
{% endif %}
{% endblock %}
